// Generated by CoffeeScript 1.7.0
(function() {
  var abstract_mapper, adapter_to_name, glob, indx, name_to_adapter, path, resolve, resolve_path, supports, _;

  path = require('path');

  glob = require('glob');

  _ = require('lodash');

  indx = require('indx');

  resolve = require('resolve');

  exports.supports = supports = function(name) {
    name = adapter_to_name(name);
    return !!glob.sync("" + (path.join(__dirname, 'adapters', name)) + ".*").length;
  };

  exports.load = function(name, custom_path) {
    var adapter, compiler, err, pkg;
    pkg = name_to_adapter(name);
    name = adapter_to_name(name);
    if (!supports(name)) {
      throw new Error("compiler '" + name + "' not supported");
    }
    if (custom_path) {
      compiler = require(resolve.sync(path.basename(custom_path), {
        basedir: custom_path
      }));
      compiler.__accord_path = custom_path;
    } else {
      try {
        compiler = require(pkg);
        compiler.__accord_path = resolve_path(pkg);
      } catch (_error) {
        err = _error;
        throw new Error("'" + pkg + "' not found. make sure it has been installed!");
      }
    }
    adapter = new (require(path.join(__dirname, 'adapters', name)))(compiler);
    return adapter;
  };

  exports.all = function() {
    return indx(path.join(__dirname, 'adapters'));
  };


  /**
   * While almost certainly one of the ugliest functions I have written in my
     time, this little utility will get the exact path to the root folder of a
     node module from wherever it would be required from given it's name.
   * @param  {String} name The name of the node module you want the path to.
   * @return {String} The root folder of node module `name`.
   * @private
   */

  resolve_path = function(name) {
    var i, p, _i, _len, _path;
    _path = require.resolve(name).split(path.sep).reverse();
    for (i = _i = 0, _len = _path.length; _i < _len; i = ++_i) {
      p = _path[i];
      if (_path[i - 1] === name && p === 'node_modules') {
        break;
      }
    }
    return _.first(_path.reverse(), _path.length - i + 1).join(path.sep);
  };

  abstract_mapper = function(name, direction) {
    var name_maps, res;
    name_maps = [['markdown', 'marked'], ['minify-js', 'uglify-js'], ['minify-css', 'clean-css'], ['minify-html', 'html-minifier'], ['mustache', 'hogan.js'], ['scss', 'node-sass'], ['haml', 'hamljs']];
    res = null;
    name_maps.forEach(function(n) {
      if (direction === 'left' && n[0] === name) {
        res = n[1];
      }
      if (direction === 'right' && n[1] === name) {
        return res = n[0];
      }
    });
    return res || name;
  };

  name_to_adapter = function(name) {
    return abstract_mapper(name, 'left');
  };

  adapter_to_name = function(name) {
    return abstract_mapper(name, 'right');
  };

}).call(this);
